# 从Vue2源码中逐步剥离的Vue2核心功能实现，并对于一些知识点和设计理念进行补充

## Observer

Observer是Vue响应式系统的核心，注意，我们这里讨论Vue2, Vue2采用的是Object.defineProperty来实现响应式，Vue3则采用Proxy来实现响应式。

这里有历史的原因，关于Proxy实现响应式，我们会在实现Vue3-Core的时候继续深入。

Observer应该叫做变化侦测，它用来侦测数据变化，然后通知视图更新，使得状态的管理变得简单。

### 变化侦测

变化侦测用于解决运行时内部数据状态发生变化时需要不停地重新渲染的问题。

#### Angular和React的做法

Angular和React的做法是很粗粒度的做法，当state change, 它们不知道哪些组件需要重新渲染，当状态改变时，会发送信号给框架，
框架收到信号后，进行暴力比对来找到需要重新渲染的DOM节点。

至于如何比对:

- Angular: 脏值检查: Angular会记录上一次的状态，当状态改变时，会比较两次状态的差异，然后进行DOM操作。
- React: 虚拟DOM: React会生成一个虚拟DOM，当状态改变时，会生成一个新虚拟DOM，然后进行比较，找出差异，然后进行DOM操作。

#### Vue的做法

对于Vue来说，它控制地更加具有细粒度。

假如有一个状态绑定着好多个依赖，每个依赖表示一个具体的DOM节点，那么当这个状态发生变化时，向这个状态的所有依赖发送通知，让它们进行DOM更新操作。

但是细粒度也是有代价的，粒度越是细，每个状态要绑定的依赖就越多，依赖追踪在内存的开销就会越来越大。

Vue2引入虚拟DOM，粒度较小，**一个状态所绑定的依赖不再是具体的DOM节点，而是一个组件**

#### 流程

1. 状态改变
2. 通知组件
3. 组件内部进行 diff patch

Vue实际上可以调整粒度的本质上原因还是采用了Observer的设计，通过这个设计，它可以随意控制这种粒度，特别的高明。

## VDOM

### 虚拟DOM

虚拟DOM是时代发展的必然产物。随着需求增多，命令式操作DOM变得特别复杂。
